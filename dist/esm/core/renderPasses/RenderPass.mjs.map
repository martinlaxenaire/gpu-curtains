{"version":3,"file":"RenderPass.mjs","sources":["../../../../src/core/renderPasses/RenderPass.ts"],"sourcesContent":["import { isRenderer, Renderer } from '../renderers/utils'\nimport { generateUUID } from '../../utils/utils'\nimport { GPUCurtains } from '../../curtains/GPUCurtains'\nimport { RenderTexture } from '../textures/RenderTexture'\n\n/** Define the parameters of a color attachment */\nexport interface ColorAttachmentParams {\n  /** The {@link GPULoadOp | load operation} to perform while drawing this {@link RenderPass} */\n  loadOp?: GPULoadOp\n  /** The {@link GPUStoreOp | store operation} to perform while drawing this {@link RenderPass} */\n  storeOp?: GPUStoreOp\n  /** The {@link GPUColor | color values} to clear to before drawing this {@link RenderPass} */\n  clearValue?: GPUColor\n  /** Optional format of the color attachment texture */\n  targetFormat: GPUTextureFormat\n}\n\n/**\n * Parameters used to create this {@link RenderPass}\n */\nexport interface RenderPassParams {\n  /** The label of the {@link RenderPass}, sent to various GPU objects for debugging purpose */\n  label?: string\n\n  /** Whether the {@link RenderPass | view and depth textures} should use multisampling or not */\n  sampleCount?: GPUSize32\n\n  /** Force all the {@link RenderPass} textures size to be set to the given ratio of the {@link core/renderers/GPURenderer.GPURenderer#displayBoundingRect | renderer display bounding rectangle}. Used mainly to shrink the rendered definition. */\n  qualityRatio?: number\n\n  /** Whether this {@link RenderPass} should handle a view texture */\n  useColorAttachments?: boolean\n  /** Whether the main (first {@link colorAttachments}) view texture should be updated each frame */\n  shouldUpdateView?: boolean\n  /** The {@link GPULoadOp | load operation} to perform while drawing this {@link RenderPass} */\n  loadOp?: GPULoadOp\n  /** The {@link GPUStoreOp | store operation} to perform while drawing this {@link RenderPass} */\n  storeOp?: GPUStoreOp\n  /** The {@link GPUColor | color values} to clear to before drawing this {@link RenderPass} */\n  clearValue?: GPUColor\n  /** Optional format of the color attachment texture */\n  targetFormat: GPUTextureFormat\n  /** Define all the color attachments parameters to use here in case this {@link RenderPass} should output to multiple color attachments (Multiple Render Targets) */\n  colorAttachments?: ColorAttachmentParams[]\n\n  /** Whether this {@link RenderPass} should handle a depth texture */\n  useDepth?: boolean\n  /** Whether this {@link RenderPass} should use an already created depth texture */\n  depthTexture?: RenderTexture\n  /** The {@link GPULoadOp | depth load operation} to perform while drawing this {@link RenderPass} */\n  depthLoadOp?: GPULoadOp\n  /** The {@link GPUStoreOp | depth store operation} to perform while drawing this {@link RenderPass} */\n  depthStoreOp?: GPUStoreOp\n  /** The depth clear value to clear to before drawing this {@link RenderPass} */\n  depthClearValue?: number\n  /** Optional format of the depth texture */\n  depthFormat?: GPUTextureFormat\n}\n\n/**\n * Used by {@link core/renderPasses/RenderTarget.RenderTarget | RenderTarget} and the {@link Renderer} to render to one or multiple {@link RenderPass#viewTextures | view textures} (and optionally a {@link RenderPass#depthTexture | depth texture}), using a specific {@link GPURenderPassDescriptor | render pass descriptor}.\n */\nexport class RenderPass {\n  /** {@link Renderer} used by this {@link RenderPass} */\n  renderer: Renderer\n  /** The type of the {@link RenderPass} */\n  type: string\n  /** The universal unique id of this {@link RenderPass} */\n  readonly uuid: string\n\n  /** Options used to create this {@link RenderPass} */\n  options: RenderPassParams\n\n  /** Depth {@link RenderTexture} to use with this {@link RenderPass} if it should handle depth */\n  depthTexture: RenderTexture | undefined\n\n  /** Array of {@link RenderTexture} used for this {@link RenderPass} color attachments view textures */\n  viewTextures: RenderTexture[]\n\n  /** The {@link RenderPass} {@link GPURenderPassDescriptor | descriptor} */\n  descriptor: GPURenderPassDescriptor\n\n  /**\n   * RenderPass constructor\n   * @param renderer - {@link Renderer} object or {@link GPUCurtains} class object used to create this {@link RenderPass}\n   * @param parameters - {@link RenderPassParams | parameters} used to create this {@link RenderPass}\n   */\n  constructor(\n    renderer: Renderer | GPUCurtains,\n    {\n      label = 'Render Pass',\n      sampleCount = 4,\n      qualityRatio = 1,\n      // color\n      useColorAttachments = true,\n      shouldUpdateView = true,\n      loadOp = 'clear' as GPULoadOp,\n      storeOp = 'store' as GPUStoreOp,\n      clearValue = [0, 0, 0, 0],\n      targetFormat,\n      colorAttachments = [],\n      // depth\n      useDepth = true,\n      depthTexture = null,\n      depthLoadOp = 'clear' as GPULoadOp,\n      depthStoreOp = 'store' as GPUStoreOp,\n      depthClearValue = 1,\n      depthFormat = 'depth24plus' as GPUTextureFormat,\n    } = {} as RenderPassParams\n  ) {\n    // we could pass our curtains object OR our curtains renderer object\n    renderer = (renderer && (renderer as GPUCurtains).renderer) || (renderer as Renderer)\n\n    isRenderer(renderer, 'RenderPass')\n\n    this.type = 'RenderPass'\n    this.uuid = generateUUID()\n\n    this.renderer = renderer\n\n    if (useColorAttachments) {\n      const defaultColorAttachment = {\n        loadOp,\n        storeOp,\n        clearValue,\n        targetFormat: targetFormat ?? this.renderer.options.preferredFormat,\n      }\n\n      if (!colorAttachments.length) {\n        colorAttachments = [defaultColorAttachment]\n      } else {\n        colorAttachments = colorAttachments.map((colorAttachment) => {\n          return { ...defaultColorAttachment, ...colorAttachment }\n        })\n      }\n    }\n\n    this.options = {\n      label,\n      sampleCount,\n      qualityRatio,\n      // color\n      useColorAttachments,\n      shouldUpdateView,\n      loadOp,\n      storeOp,\n      clearValue,\n      targetFormat: targetFormat ?? this.renderer.options.preferredFormat,\n      colorAttachments,\n      // depth\n      useDepth,\n      ...(depthTexture !== undefined && { depthTexture }),\n      depthLoadOp,\n      depthStoreOp,\n      depthClearValue,\n      depthFormat,\n    }\n\n    this.setClearValue(clearValue)\n\n    // if needed, create a depth texture before our descriptor\n    if (this.options.useDepth) {\n      this.createDepthTexture()\n    }\n\n    // if needed, create a view texture before our descriptor\n    this.viewTextures = []\n    if (this.options.useColorAttachments) {\n      this.createViewTextures()\n    }\n\n    this.setRenderPassDescriptor()\n  }\n\n  /**\n   * Create and set our {@link depthTexture | depth texture}\n   */\n  createDepthTexture() {\n    if (this.options.depthTexture) {\n      this.depthTexture = this.options.depthTexture\n      // adjust depth format as well\n      this.options.depthFormat = this.options.depthTexture.options.format\n    } else {\n      this.depthTexture = new RenderTexture(this.renderer, {\n        label: this.options.label + ' depth texture',\n        name: 'depthTexture',\n        usage: 'depth',\n        format: this.options.depthFormat,\n        sampleCount: this.options.sampleCount,\n        qualityRatio: this.options.qualityRatio,\n      })\n    }\n  }\n\n  /**\n   * Create and set our {@link viewTextures | view textures}\n   */\n  createViewTextures() {\n    this.options.colorAttachments.forEach((colorAttachment, index) => {\n      this.viewTextures.push(\n        new RenderTexture(this.renderer, {\n          label: `${this.options.label} colorAttachment[${index}] view texture`,\n          name: `colorAttachment${index}ViewTexture`,\n          format: colorAttachment.targetFormat,\n          sampleCount: this.options.sampleCount,\n          qualityRatio: this.options.qualityRatio,\n        })\n      )\n    })\n  }\n\n  /**\n   * Set our render pass {@link descriptor}\n   */\n  setRenderPassDescriptor() {\n    this.descriptor = {\n      label: this.options.label + ' descriptor',\n      colorAttachments: this.options.colorAttachments.map((colorAttachment, index) => {\n        return {\n          // view\n          view: this.viewTextures[index].texture.createView({\n            label: this.viewTextures[index].texture.label + ' view',\n          }),\n          // clear values\n          clearValue: colorAttachment.clearValue,\n          // loadOp: 'clear' specifies to clear the texture to the clear value before drawing\n          // The other option is 'load' which means load the existing contents of the texture into the GPU so we can draw over what's already there.\n          loadOp: colorAttachment.loadOp,\n          // storeOp: 'store' means store the result of what we draw.\n          // We could also pass 'discard' which would throw away what we draw.\n          // see https://webgpufundamentals.org/webgpu/lessons/webgpu-multisampling.html\n          storeOp: colorAttachment.storeOp,\n        }\n      }),\n\n      ...(this.options.useDepth && {\n        depthStencilAttachment: {\n          view: this.depthTexture.texture.createView({\n            label: this.depthTexture.texture.label + ' view',\n          }),\n          depthClearValue: this.options.depthClearValue,\n          // the same way loadOp is working, we can specify if we want to clear or load the previous depth buffer result\n          depthLoadOp: this.options.depthLoadOp,\n          depthStoreOp: this.options.depthStoreOp,\n        },\n      }),\n    } as GPURenderPassDescriptor\n  }\n\n  /**\n   * Resize our {@link RenderPass}: reset its {@link RenderTexture}\n   */\n  resize() {\n    // reassign textures\n    if (this.options.useDepth) {\n      this.descriptor.depthStencilAttachment.view = this.depthTexture.texture.createView({\n        label: this.depthTexture.options.label + ' view',\n      })\n    }\n\n    this.viewTextures.forEach((viewTexture, index) => {\n      this.descriptor.colorAttachments[index].view = viewTexture.texture.createView({\n        label: viewTexture.options.label + ' view',\n      })\n    })\n  }\n\n  /**\n   * Set the {@link descriptor} {@link GPULoadOp | load operation}\n   * @param loadOp - new {@link GPULoadOp | load operation} to use\n   * @param colorAttachmentIndex - index of the color attachment for which to use this load operation\n   */\n  setLoadOp(loadOp: GPULoadOp = 'clear', colorAttachmentIndex = 0) {\n    this.options.loadOp = loadOp\n    if (this.options.useColorAttachments && this.descriptor) {\n      if (this.descriptor.colorAttachments && this.descriptor.colorAttachments[colorAttachmentIndex]) {\n        this.descriptor.colorAttachments[colorAttachmentIndex].loadOp = loadOp\n      }\n    }\n  }\n\n  /**\n   * Set the {@link descriptor} {@link GPULoadOp | depth load operation}\n   * @param depthLoadOp - new {@link GPULoadOp | depth load operation} to use\n   */\n  setDepthLoadOp(depthLoadOp: GPULoadOp = 'clear') {\n    this.options.depthLoadOp = depthLoadOp\n    if (this.options.useDepth && this.descriptor.depthStencilAttachment) {\n      this.descriptor.depthStencilAttachment.depthLoadOp = depthLoadOp\n    }\n  }\n\n  /**\n   * Set our {@link GPUColor | clear colors value}.<br>\n   * Beware that if the {@link renderer} is using {@link core/renderers/GPURenderer.GPURenderer#alphaMode | premultiplied alpha mode}, your R, G and B channels should be premultiplied by your alpha channel.\n   * @param clearValue - new {@link GPUColor | clear colors value} to use\n   * @param colorAttachmentIndex - index of the color attachment for which to use this clear value\n   */\n  setClearValue(clearValue: GPUColor = [0, 0, 0, 0], colorAttachmentIndex = 0) {\n    if (this.renderer.alphaMode === 'premultiplied') {\n      const alpha = clearValue[3]\n      clearValue[0] = Math.min(clearValue[0], alpha)\n      clearValue[1] = Math.min(clearValue[1], alpha)\n      clearValue[2] = Math.min(clearValue[2], alpha)\n    } else {\n      this.options.clearValue = clearValue\n    }\n\n    if (this.descriptor && this.descriptor.colorAttachments && this.descriptor.colorAttachments[colorAttachmentIndex]) {\n      this.descriptor.colorAttachments[colorAttachmentIndex].clearValue = clearValue\n    }\n  }\n\n  /**\n   * Set the current {@link descriptor} texture {@link GPURenderPassColorAttachment#view | view} and {@link GPURenderPassColorAttachment#resolveTarget | resolveTarget} (depending on whether we're using multisampling)\n   * @param renderTexture - {@link GPUTexture} to use, or the {@link core/renderers/GPURenderer.GPURenderer#context | context} {@link GPUTexture | current texture} if null.\n   * @returns - the {@link GPUTexture | texture} to render to.\n   */\n  updateView(renderTexture: GPUTexture | null = null): GPUTexture | null {\n    if (!this.options.colorAttachments.length || !this.options.shouldUpdateView) {\n      return renderTexture\n    }\n\n    if (!renderTexture) {\n      renderTexture = this.renderer.context.getCurrentTexture()\n      renderTexture.label = `${this.renderer.type} context current texture`\n    }\n\n    if (this.options.sampleCount > 1) {\n      this.descriptor.colorAttachments[0].view = this.viewTextures[0].texture.createView({\n        label: this.viewTextures[0].options.label + ' view',\n      })\n      this.descriptor.colorAttachments[0].resolveTarget = renderTexture.createView({\n        label: renderTexture.label + ' resolve target view',\n      })\n    } else {\n      this.descriptor.colorAttachments[0].view = renderTexture.createView({\n        label: renderTexture.label + ' view',\n      })\n    }\n\n    return renderTexture\n  }\n\n  /**\n   * Destroy our {@link RenderPass}\n   */\n  destroy() {\n    this.viewTextures.forEach((viewTexture) => viewTexture.destroy())\n\n    if (!this.options.depthTexture && this.depthTexture) {\n      this.depthTexture.destroy()\n    }\n  }\n}\n"],"names":[],"mappings":";;;;AA8DO,MAAM,UAAW,CAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAyBtB,YACE,QACA,EAAA;AAAA,IACE,KAAQ,GAAA,aAAA;AAAA,IACR,WAAc,GAAA,CAAA;AAAA,IACd,YAAe,GAAA,CAAA;AAAA;AAAA,IAEf,mBAAsB,GAAA,IAAA;AAAA,IACtB,gBAAmB,GAAA,IAAA;AAAA,IACnB,MAAS,GAAA,OAAA;AAAA,IACT,OAAU,GAAA,OAAA;AAAA,IACV,UAAa,GAAA,CAAC,CAAG,EAAA,CAAA,EAAG,GAAG,CAAC,CAAA;AAAA,IACxB,YAAA;AAAA,IACA,mBAAmB,EAAC;AAAA;AAAA,IAEpB,QAAW,GAAA,IAAA;AAAA,IACX,YAAe,GAAA,IAAA;AAAA,IACf,WAAc,GAAA,OAAA;AAAA,IACd,YAAe,GAAA,OAAA;AAAA,IACf,eAAkB,GAAA,CAAA;AAAA,IAClB,WAAc,GAAA,aAAA;AAAA,GAChB,GAAI,EACJ,EAAA;AAEA,IAAY,QAAA,GAAA,QAAA,IAAa,SAAyB,QAAc,IAAA,QAAA,CAAA;AAEhE,IAAA,UAAA,CAAW,UAAU,YAAY,CAAA,CAAA;AAEjC,IAAA,IAAA,CAAK,IAAO,GAAA,YAAA,CAAA;AACZ,IAAA,IAAA,CAAK,OAAO,YAAa,EAAA,CAAA;AAEzB,IAAA,IAAA,CAAK,QAAW,GAAA,QAAA,CAAA;AAEhB,IAAA,IAAI,mBAAqB,EAAA;AACvB,MAAA,MAAM,sBAAyB,GAAA;AAAA,QAC7B,MAAA;AAAA,QACA,OAAA;AAAA,QACA,UAAA;AAAA,QACA,YAAc,EAAA,YAAA,IAAgB,IAAK,CAAA,QAAA,CAAS,OAAQ,CAAA,eAAA;AAAA,OACtD,CAAA;AAEA,MAAI,IAAA,CAAC,iBAAiB,MAAQ,EAAA;AAC5B,QAAA,gBAAA,GAAmB,CAAC,sBAAsB,CAAA,CAAA;AAAA,OACrC,MAAA;AACL,QAAmB,gBAAA,GAAA,gBAAA,CAAiB,GAAI,CAAA,CAAC,eAAoB,KAAA;AAC3D,UAAA,OAAO,EAAE,GAAG,sBAAwB,EAAA,GAAG,eAAgB,EAAA,CAAA;AAAA,SACxD,CAAA,CAAA;AAAA,OACH;AAAA,KACF;AAEA,IAAA,IAAA,CAAK,OAAU,GAAA;AAAA,MACb,KAAA;AAAA,MACA,WAAA;AAAA,MACA,YAAA;AAAA;AAAA,MAEA,mBAAA;AAAA,MACA,gBAAA;AAAA,MACA,MAAA;AAAA,MACA,OAAA;AAAA,MACA,UAAA;AAAA,MACA,YAAc,EAAA,YAAA,IAAgB,IAAK,CAAA,QAAA,CAAS,OAAQ,CAAA,eAAA;AAAA,MACpD,gBAAA;AAAA;AAAA,MAEA,QAAA;AAAA,MACA,GAAI,YAAA,KAAiB,KAAa,CAAA,IAAA,EAAE,YAAa,EAAA;AAAA,MACjD,WAAA;AAAA,MACA,YAAA;AAAA,MACA,eAAA;AAAA,MACA,WAAA;AAAA,KACF,CAAA;AAEA,IAAA,IAAA,CAAK,cAAc,UAAU,CAAA,CAAA;AAG7B,IAAI,IAAA,IAAA,CAAK,QAAQ,QAAU,EAAA;AACzB,MAAA,IAAA,CAAK,kBAAmB,EAAA,CAAA;AAAA,KAC1B;AAGA,IAAA,IAAA,CAAK,eAAe,EAAC,CAAA;AACrB,IAAI,IAAA,IAAA,CAAK,QAAQ,mBAAqB,EAAA;AACpC,MAAA,IAAA,CAAK,kBAAmB,EAAA,CAAA;AAAA,KAC1B;AAEA,IAAA,IAAA,CAAK,uBAAwB,EAAA,CAAA;AAAA,GAC/B;AAAA;AAAA;AAAA;AAAA,EAKA,kBAAqB,GAAA;AACnB,IAAI,IAAA,IAAA,CAAK,QAAQ,YAAc,EAAA;AAC7B,MAAK,IAAA,CAAA,YAAA,GAAe,KAAK,OAAQ,CAAA,YAAA,CAAA;AAEjC,MAAA,IAAA,CAAK,OAAQ,CAAA,WAAA,GAAc,IAAK,CAAA,OAAA,CAAQ,aAAa,OAAQ,CAAA,MAAA,CAAA;AAAA,KACxD,MAAA;AACL,MAAA,IAAA,CAAK,YAAe,GAAA,IAAI,aAAc,CAAA,IAAA,CAAK,QAAU,EAAA;AAAA,QACnD,KAAA,EAAO,IAAK,CAAA,OAAA,CAAQ,KAAQ,GAAA,gBAAA;AAAA,QAC5B,IAAM,EAAA,cAAA;AAAA,QACN,KAAO,EAAA,OAAA;AAAA,QACP,MAAA,EAAQ,KAAK,OAAQ,CAAA,WAAA;AAAA,QACrB,WAAA,EAAa,KAAK,OAAQ,CAAA,WAAA;AAAA,QAC1B,YAAA,EAAc,KAAK,OAAQ,CAAA,YAAA;AAAA,OAC5B,CAAA,CAAA;AAAA,KACH;AAAA,GACF;AAAA;AAAA;AAAA;AAAA,EAKA,kBAAqB,GAAA;AACnB,IAAA,IAAA,CAAK,OAAQ,CAAA,gBAAA,CAAiB,OAAQ,CAAA,CAAC,iBAAiB,KAAU,KAAA;AAChE,MAAA,IAAA,CAAK,YAAa,CAAA,IAAA;AAAA,QAChB,IAAI,aAAc,CAAA,IAAA,CAAK,QAAU,EAAA;AAAA,UAC/B,OAAO,CAAG,EAAA,IAAA,CAAK,OAAQ,CAAA,KAAK,oBAAoB,KAAK,CAAA,cAAA,CAAA;AAAA,UACrD,IAAA,EAAM,kBAAkB,KAAK,CAAA,WAAA,CAAA;AAAA,UAC7B,QAAQ,eAAgB,CAAA,YAAA;AAAA,UACxB,WAAA,EAAa,KAAK,OAAQ,CAAA,WAAA;AAAA,UAC1B,YAAA,EAAc,KAAK,OAAQ,CAAA,YAAA;AAAA,SAC5B,CAAA;AAAA,OACH,CAAA;AAAA,KACD,CAAA,CAAA;AAAA,GACH;AAAA;AAAA;AAAA;AAAA,EAKA,uBAA0B,GAAA;AACxB,IAAA,IAAA,CAAK,UAAa,GAAA;AAAA,MAChB,KAAA,EAAO,IAAK,CAAA,OAAA,CAAQ,KAAQ,GAAA,aAAA;AAAA,MAC5B,kBAAkB,IAAK,CAAA,OAAA,CAAQ,iBAAiB,GAAI,CAAA,CAAC,iBAAiB,KAAU,KAAA;AAC9E,QAAO,OAAA;AAAA;AAAA,UAEL,MAAM,IAAK,CAAA,YAAA,CAAa,KAAK,CAAA,CAAE,QAAQ,UAAW,CAAA;AAAA,YAChD,OAAO,IAAK,CAAA,YAAA,CAAa,KAAK,CAAA,CAAE,QAAQ,KAAQ,GAAA,OAAA;AAAA,WACjD,CAAA;AAAA;AAAA,UAED,YAAY,eAAgB,CAAA,UAAA;AAAA;AAAA;AAAA,UAG5B,QAAQ,eAAgB,CAAA,MAAA;AAAA;AAAA;AAAA;AAAA,UAIxB,SAAS,eAAgB,CAAA,OAAA;AAAA,SAC3B,CAAA;AAAA,OACD,CAAA;AAAA,MAED,GAAI,IAAK,CAAA,OAAA,CAAQ,QAAY,IAAA;AAAA,QAC3B,sBAAwB,EAAA;AAAA,UACtB,IAAM,EAAA,IAAA,CAAK,YAAa,CAAA,OAAA,CAAQ,UAAW,CAAA;AAAA,YACzC,KAAO,EAAA,IAAA,CAAK,YAAa,CAAA,OAAA,CAAQ,KAAQ,GAAA,OAAA;AAAA,WAC1C,CAAA;AAAA,UACD,eAAA,EAAiB,KAAK,OAAQ,CAAA,eAAA;AAAA;AAAA,UAE9B,WAAA,EAAa,KAAK,OAAQ,CAAA,WAAA;AAAA,UAC1B,YAAA,EAAc,KAAK,OAAQ,CAAA,YAAA;AAAA,SAC7B;AAAA,OACF;AAAA,KACF,CAAA;AAAA,GACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAS,GAAA;AAEP,IAAI,IAAA,IAAA,CAAK,QAAQ,QAAU,EAAA;AACzB,MAAA,IAAA,CAAK,WAAW,sBAAuB,CAAA,IAAA,GAAO,IAAK,CAAA,YAAA,CAAa,QAAQ,UAAW,CAAA;AAAA,QACjF,KAAO,EAAA,IAAA,CAAK,YAAa,CAAA,OAAA,CAAQ,KAAQ,GAAA,OAAA;AAAA,OAC1C,CAAA,CAAA;AAAA,KACH;AAEA,IAAA,IAAA,CAAK,YAAa,CAAA,OAAA,CAAQ,CAAC,WAAA,EAAa,KAAU,KAAA;AAChD,MAAA,IAAA,CAAK,WAAW,gBAAiB,CAAA,KAAK,EAAE,IAAO,GAAA,WAAA,CAAY,QAAQ,UAAW,CAAA;AAAA,QAC5E,KAAA,EAAO,WAAY,CAAA,OAAA,CAAQ,KAAQ,GAAA,OAAA;AAAA,OACpC,CAAA,CAAA;AAAA,KACF,CAAA,CAAA;AAAA,GACH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,SAAU,CAAA,MAAA,GAAoB,OAAS,EAAA,oBAAA,GAAuB,CAAG,EAAA;AAC/D,IAAA,IAAA,CAAK,QAAQ,MAAS,GAAA,MAAA,CAAA;AACtB,IAAA,IAAI,IAAK,CAAA,OAAA,CAAQ,mBAAuB,IAAA,IAAA,CAAK,UAAY,EAAA;AACvD,MAAA,IAAI,KAAK,UAAW,CAAA,gBAAA,IAAoB,KAAK,UAAW,CAAA,gBAAA,CAAiB,oBAAoB,CAAG,EAAA;AAC9F,QAAA,IAAA,CAAK,UAAW,CAAA,gBAAA,CAAiB,oBAAoB,CAAA,CAAE,MAAS,GAAA,MAAA,CAAA;AAAA,OAClE;AAAA,KACF;AAAA,GACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,cAAA,CAAe,cAAyB,OAAS,EAAA;AAC/C,IAAA,IAAA,CAAK,QAAQ,WAAc,GAAA,WAAA,CAAA;AAC3B,IAAA,IAAI,IAAK,CAAA,OAAA,CAAQ,QAAY,IAAA,IAAA,CAAK,WAAW,sBAAwB,EAAA;AACnE,MAAK,IAAA,CAAA,UAAA,CAAW,uBAAuB,WAAc,GAAA,WAAA,CAAA;AAAA,KACvD;AAAA,GACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,aAAA,CAAc,aAAuB,CAAC,CAAA,EAAG,GAAG,CAAG,EAAA,CAAC,CAAG,EAAA,oBAAA,GAAuB,CAAG,EAAA;AAC3E,IAAI,IAAA,IAAA,CAAK,QAAS,CAAA,SAAA,KAAc,eAAiB,EAAA;AAC/C,MAAM,MAAA,KAAA,GAAQ,WAAW,CAAC,CAAA,CAAA;AAC1B,MAAA,UAAA,CAAW,CAAC,CAAI,GAAA,IAAA,CAAK,IAAI,UAAW,CAAA,CAAC,GAAG,KAAK,CAAA,CAAA;AAC7C,MAAA,UAAA,CAAW,CAAC,CAAI,GAAA,IAAA,CAAK,IAAI,UAAW,CAAA,CAAC,GAAG,KAAK,CAAA,CAAA;AAC7C,MAAA,UAAA,CAAW,CAAC,CAAI,GAAA,IAAA,CAAK,IAAI,UAAW,CAAA,CAAC,GAAG,KAAK,CAAA,CAAA;AAAA,KACxC,MAAA;AACL,MAAA,IAAA,CAAK,QAAQ,UAAa,GAAA,UAAA,CAAA;AAAA,KAC5B;AAEA,IAAI,IAAA,IAAA,CAAK,cAAc,IAAK,CAAA,UAAA,CAAW,oBAAoB,IAAK,CAAA,UAAA,CAAW,gBAAiB,CAAA,oBAAoB,CAAG,EAAA;AACjH,MAAA,IAAA,CAAK,UAAW,CAAA,gBAAA,CAAiB,oBAAoB,CAAA,CAAE,UAAa,GAAA,UAAA,CAAA;AAAA,KACtE;AAAA,GACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,UAAA,CAAW,gBAAmC,IAAyB,EAAA;AACrE,IAAI,IAAA,CAAC,KAAK,OAAQ,CAAA,gBAAA,CAAiB,UAAU,CAAC,IAAA,CAAK,QAAQ,gBAAkB,EAAA;AAC3E,MAAO,OAAA,aAAA,CAAA;AAAA,KACT;AAEA,IAAA,IAAI,CAAC,aAAe,EAAA;AAClB,MAAgB,aAAA,GAAA,IAAA,CAAK,QAAS,CAAA,OAAA,CAAQ,iBAAkB,EAAA,CAAA;AACxD,MAAA,aAAA,CAAc,KAAQ,GAAA,CAAA,EAAG,IAAK,CAAA,QAAA,CAAS,IAAI,CAAA,wBAAA,CAAA,CAAA;AAAA,KAC7C;AAEA,IAAI,IAAA,IAAA,CAAK,OAAQ,CAAA,WAAA,GAAc,CAAG,EAAA;AAChC,MAAK,IAAA,CAAA,UAAA,CAAW,gBAAiB,CAAA,CAAC,CAAE,CAAA,IAAA,GAAO,KAAK,YAAa,CAAA,CAAC,CAAE,CAAA,OAAA,CAAQ,UAAW,CAAA;AAAA,QACjF,OAAO,IAAK,CAAA,YAAA,CAAa,CAAC,CAAA,CAAE,QAAQ,KAAQ,GAAA,OAAA;AAAA,OAC7C,CAAA,CAAA;AACD,MAAA,IAAA,CAAK,WAAW,gBAAiB,CAAA,CAAC,CAAE,CAAA,aAAA,GAAgB,cAAc,UAAW,CAAA;AAAA,QAC3E,KAAA,EAAO,cAAc,KAAQ,GAAA,sBAAA;AAAA,OAC9B,CAAA,CAAA;AAAA,KACI,MAAA;AACL,MAAA,IAAA,CAAK,WAAW,gBAAiB,CAAA,CAAC,CAAE,CAAA,IAAA,GAAO,cAAc,UAAW,CAAA;AAAA,QAClE,KAAA,EAAO,cAAc,KAAQ,GAAA,OAAA;AAAA,OAC9B,CAAA,CAAA;AAAA,KACH;AAEA,IAAO,OAAA,aAAA,CAAA;AAAA,GACT;AAAA;AAAA;AAAA;AAAA,EAKA,OAAU,GAAA;AACR,IAAA,IAAA,CAAK,aAAa,OAAQ,CAAA,CAAC,WAAgB,KAAA,WAAA,CAAY,SAAS,CAAA,CAAA;AAEhE,IAAA,IAAI,CAAC,IAAA,CAAK,OAAQ,CAAA,YAAA,IAAgB,KAAK,YAAc,EAAA;AACnD,MAAA,IAAA,CAAK,aAAa,OAAQ,EAAA,CAAA;AAAA,KAC5B;AAAA,GACF;AACF;;;;"}